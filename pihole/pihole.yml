# More info at https://github.com/pi-hole/docker-pi-hole/ and https://docs.pi-hole.net/
services:
  pihole:
    container_name: pihole
    image: pihole/pihole:latest
    # ports:
    #   # DNS Ports
    #   - "53:53/tcp"
    #   - "53:53/udp"
    #   # Default HTTP Port
    #   - "84:80/tcp"
    #   # Default HTTPs Port. FTL will generate a self-signed certificate
    #   # - "443:443/tcp"
    #   # Uncomment the below if using Pi-hole as your DHCP Server
    #   #- "67:67/udp"
    #   # Uncomment the line below if you are using Pi-hole as your NTP server
    #   #- "123:123/udp"
    environment:
      # Set the appropriate timezone for your location from
      # https://en.wikipedia.org/wiki/List_of_tz_database_time_zones, e.g:
      TZ: ${TZ}
      FTLCONF_webserver_interface_theme: "default-darker"
      # Set a password to access the web interface. Not setting one will result in a random password being assigned
      FTLCONF_webserver_api_password: ${password}
      # If using Docker's default `bridge` network setting the dns listening mode should be set to 'ALL'
      FTLCONF_dns_listeningMode: "ALL"
      FTLCONF_dns_upstreams: ${dns_upstreams}
      FTLCONF_dns_hosts: ${dns_hosts}
      # FTLCONF_webserver_port: ${port}
    # Volumes store your data between container upgrades
    volumes:
      # For persisting Pi-hole's databases and common configuration file
      - "./pihole/etc:/etc/pihole"
      # Uncomment the below if you have custom dnsmasq config files that you want to persist. Not needed for most starting fresh with Pi-hole v6. If you're upgrading from v5 you and have used this directory before, you should keep it enabled for the first v6 container start to allow for a complete migration. It can be removed afterwards. Needs environment variable FTLCONF_misc_etc_dnsmasq_d: 'true'
      #- './etc-dnsmasq.d:/etc/dnsmasq.d'
    cap_add:
      # See https://github.com/pi-hole/docker-pi-hole#note-on-capabilities
      # Required if you are using Pi-hole as your DHCP server, else not needed
      - NET_ADMIN
      # Required if you are using Pi-hole as your NTP client to be able to set the host's system time
      - SYS_TIME
      # Optional, if Pi-hole should get some more processing time
      - SYS_NICE
    restart: unless-stopped
    network_mode: service:ts-pihole

  ts-pihole: #I use example to give example name replace it with the name for your actual service
    container_name: ts-pihole
    hostname: pihole
    image: tailscale/tailscale:latest
    ports:
      - 84:80 #exposes your service in port for localhost
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY} #create a .env file on the dir where this yml is and assign TS_AUTHKEY=yourauthkey there
      - TS_STATE_DIR=/var/lib/tailscale
      #- TS_SERVE_CONFIG=/config/example-serve.json #if you use serve change example-serve.json to your serve config file name and edit it as necessary. you can also see funnel there. Serve causes your service to be accessable by https on your tailscale network whereas funnel makes it accessable on the public internet via https. You can use either serve or funnel or both. Read more about it in tailscale docs.
      - TS_EXTRA_ARGS=--advertise-exit-node
      - TS_USERSPACE=false
    volumes:
      - ${TS_STATE_DIR}:/var/lib/tailscale
      - ${TS_CONFIG_DIR}:/config #this is where you will keep your serve configs
    devices:
      - /dev/net/tun:/dev/net/tun
    cap_add:
      - net_admin
    restart: unless-stopped
